<!DOCTYPE html>
<html class="light" lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <title>Tus Datos</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = { theme: { extend: { colors: { "primary": "#13ec5b" }, fontFamily: { "display": ["Manrope", "sans-serif"] } } } }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet"/>
</head>
<body class="bg-[#f6f8f6] font-display min-h-screen flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-md p-6 rounded-3xl shadow-sm border border-gray-100">
        <h1 class="text-xl font-extrabold mb-1 text-gray-900">Casi listo</h1>
        <p class="text-gray-500 mb-6 text-sm">Ingresa tus datos para confirmar.</p>
        
        <form id="booking-form" class="flex flex-col gap-4">
            <div class="space-y-3">
                <input id="name" class="w-full h-14 px-4 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-primary text-base font-medium placeholder-gray-400" placeholder="Nombre completo" required/>
                <input id="phone" type="tel" class="w-full h-14 px-4 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-primary text-base font-medium placeholder-gray-400" placeholder="WhatsApp (sin 0 ni 15)" required/>
            </div>
            
            <div class="bg-primary/10 p-4 rounded-xl border border-primary/20 mt-2">
                <p class="text-xs font-bold text-green-800 uppercase mb-1">Resumen del turno</p>
                <p class="font-bold text-gray-900 text-sm flex justify-between">
                    <span id="summary-date">...</span>
                    <span id="summary-time">--:-- hs</span>
                </p>
                <p id="summary-service" class="text-sm text-gray-600 mt-1">...</p>
            </div>

            <button type="submit" id="btn-save" class="mt-2 w-full h-14 bg-primary text-black font-extrabold text-base rounded-xl shadow-lg shadow-primary/25 active:scale-[0.98] transition-transform">
                Confirmar Reserva
            </button>
        </form>
    </div>

    <script>
        const supabase = window.supabase.createClient(
            'https://qeuiiwswouxgfnmjfqyq.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFldWlpd3N3b3V4Z2ZubWpmcXlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MzI0NDQsImV4cCI6MjA4MTQwODQ0NH0.rjhBWx61XtA-hMxzFLnOaKr9ybQk3Zbj5hnU0jxXhpw'
        );
        const time = localStorage.getItem('turno_seleccionado');
        const date = localStorage.getItem('fecha_seleccionada');
        const negocioEmail = localStorage.getItem('negocio_destino'); 
        let servicio = {name: "Servicio", price: ""};
        try { servicio = JSON.parse(localStorage.getItem('servicio_seleccionado')); } catch(e){}

        document.getElementById('summary-time').innerText = time;
        document.getElementById('summary-date').innerText = date.split('-').reverse().join('/');
        document.getElementById('summary-service').innerText = `${servicio.name} ${servicio.price ? '($'+servicio.price+')' : ''}`;

        document.getElementById('booking-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-save');
            btn.disabled = true; btn.innerText = "Procesando...";
            const bookingData = { client_name: document.getElementById('name').value, client_phone: document.getElementById('phone').value, business_email: negocioEmail, booking_date: date, booking_time: time, service_name: servicio.name, status: 'pendiente' };
            const { error } = await supabase.from('bookings').insert([bookingData]);
            if (error) { alert('Error: ' + error.message); btn.disabled = false; }
            else { window.location.href = 'confirmacion.html'; }
        });
    </script>
</body>
</html>